/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/rgb.h>

/ {
    behaviors {
        nav_mo_tog: nav_mo_tog {
            compatible = "zmk,behavior-tap-dance";
            label = "NAV_MO_TOG";
            #binding-cells = <0>;
            bindings = <&mo 2>, <&tog 2>;
        };

        special_mo_tog: special_mo_tog {
            compatible = "zmk,behavior-tap-dance";
            label = "SPECIAL_MO_TOG";
            #binding-cells = <0>;
            bindings = <&mo 1>, <&tog 1>;
        };

        as_ht: autoshift_hold_tap {
            compatible = "zmk,behavior-hold-tap";
            label = "AUTOSHIFT_HOLD_TAP";
            bindings = <&shift>, <&kp>;

            #binding-cells = <2>;
            tapping-term-ms = <200>;
        };

        // Czech characters using ABC Extended dead keys
        cs_e_mm: cs_e_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_e>, <&cs_e_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_s_mm: cs_s_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_s>, <&cs_s_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_c_mm: cs_c_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_c>, <&cs_c_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_r_mm: cs_r_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_r>, <&cs_r_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_z_mm: cs_z_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_z>, <&cs_z_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_y_mm: cs_y_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_y>, <&cs_y_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_a_mm: cs_a_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_a>, <&cs_a_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_i_mm: cs_i_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_i>, <&cs_i_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_ee_mm: cs_ee_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_ee>, <&cs_ee_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_u_mm: cs_u_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_u>, <&cs_u_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
        cs_uu_mm: cs_uu_mm {
            compatible = "zmk,behavior-mod-morph";
            #binding-cells = <0>;
            bindings = <&cs_uu>, <&cs_uu_upper>;
            mods = <(MOD_LSFT|MOD_RSFT)>;
        };
    };

    macros {
        shift: shift {
            compatible = "zmk,behavior-macro-one-param";
            #binding-cells = <1>;
            bindings =
                <&macro_press>,
                <&kp LEFT_SHIFT>,
                <&macro_tap>,
                <&macro_param_1to1 &kp MACRO_PLACEHOLDER>,
                <&macro_release>,
                <&kp LEFT_SHIFT>;

            label = "SHIFT";
        };

        // Czech characters via ABC Extended dead keys
        // ě (Option+V, E)
        cs_e: cs_e {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp E>;
        };
        cs_e_upper: cs_e_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp LS(E)>;
        };

        // š (Option+V, S)
        cs_s: cs_s {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp S>;
        };
        cs_s_upper: cs_s_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp LS(S)>;
        };

        // č (Option+V, C)
        cs_c: cs_c {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp C>;
        };
        cs_c_upper: cs_c_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp LS(C)>;
        };

        // ř (Option+V, R)
        cs_r: cs_r {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp R>;
        };
        cs_r_upper: cs_r_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp LS(R)>;
        };

        // ž (Option+V, Z)
        cs_z: cs_z {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp Z>;
        };
        cs_z_upper: cs_z_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp V>, <&macro_release &kp LALT>, <&macro_tap &kp LS(Z)>;
        };

        // ý (Option+E, Y)
        cs_y: cs_y {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp Y>;
        };
        cs_y_upper: cs_y_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp LS(Y)>;
        };

        // á (Option+E, A)
        cs_a: cs_a {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp A>;
        };
        cs_a_upper: cs_a_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp LS(A)>;
        };

        // í (Option+E, I)
        cs_i: cs_i {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp I>;
        };
        cs_i_upper: cs_i_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp LS(I)>;
        };

        // é (Option+E, E)
        cs_ee: cs_ee {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp E>;
        };
        cs_ee_upper: cs_ee_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp LS(E)>;
        };

        // ú (Option+E, U)
        cs_u: cs_u {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp U>;
        };
        cs_u_upper: cs_u_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp E>, <&macro_release &kp LALT>, <&macro_tap &kp LS(U)>;
        };

        // ů (Option+A, U)
        cs_uu: cs_uu {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp A>, <&macro_release &kp LALT>, <&macro_tap &kp U>;
        };
        cs_uu_upper: cs_uu_upper {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&macro_press &kp LALT>, <&macro_tap &kp A>, <&macro_release &kp LALT>, <&macro_tap &kp LS(U)>;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        default_layer {
            // ------------------------------------------------------------------------------------------------------------
            // |  ESC  |  1  |  2  |  3   |  4   |  5   |                   |  6   |  7    |  8    |  9   |   0   |   `   |
            // |  TAB  |  Q  |  W  |  E   |  R   |  T   |                   |  Y   |  U    |  I    |  O   |   P   |   -   |
            // |  CTRL |  A  |  S  |  D   |  F   |  G   |                   |  H   |  J    |  K    |  L   |   ;   |   '   |
            // | SHIFT |  Z  |  X  |  C   |  V   |  B   |   "["  |  |  "]"  |  N   |  M    |  ,    |  .   |   /   | CAPS |
            //                     | ALT  | GUI  | CZECH|  SPACE |  | ENTER | RAISE| BSPC  | GUI   |

            display-name = "Base";
            bindings = <
&kp ESC    &kp N1  &kp N2  &kp N3    &kp N4    &kp N5                                  &kp N6       &kp N7    &kp N8     &kp N9   &kp N0    &kp GRAVE
&kp TAB    &kp Q   &kp W   &kp E     &kp R     &kp T                                   &kp Y        &kp U     &kp I      &kp O    &kp P     &kp MINUS
&kp LCTRL  &kp A   &kp S   &kp D     &kp F     &kp G                                   &kp H        &kp J     &kp K      &kp L    &kp SEMI  &kp SQT
&kp LSHFT  &kp Z   &kp X   &kp C     &kp V     &kp B            &kp LBKT     &kp RBKT  &kp N        &kp M     &kp COMMA  &kp DOT  &kp FSLH  &caps_word
                           &kp LALT  &kp LGUI  &special_mo_tog  &kp SPACE    &kp RET   &nav_mo_tog  &kp BSPC  &kp RGUI
            >;
        };

        czech {
            // ------------------------------------------------------------------------------------------------------------
            // (Mostly transparent; only the shown keys differ from Base)
            // |       |  +  |  ě  |  š   |  č   |  ř   |                   |  ž   |  ý    |  á    |  í   |   é   |       |
            // |       |     |     |      |      |      |                   |      |       |       |      |       |   ú   |
            // |       |     |     |      |      |      |                   |      |       |       |      |   ů   |       |
            // |       |     |     |      |      |      |        |  |       |      |       |       |      |       |       |
            //                     |      |      |      |        |  |       |      |       |       |

            display-name = "Czech";
            bindings = <
&trans  &kp KP_PLUS  &cs_e_mm     &cs_s_mm     &cs_c_mm     &cs_r_mm                         &cs_z_mm     &cs_y_mm     &cs_a_mm     &cs_i_mm     &cs_ee_mm    &trans
&trans  &trans       &trans       &trans       &trans       &trans                           &trans       &trans       &trans       &trans       &trans       &cs_u_mm
&trans  &trans       &trans       &trans       &trans       &trans                           &trans       &trans       &trans       &trans       &cs_uu_mm    &trans
&trans  &trans       &trans       &trans       &trans       &trans       &trans    &trans      &trans       &trans       &trans       &trans       &trans       &trans
                        &trans    &trans       &trans       &trans    &trans                    &trans       &trans       &trans
            >;
        };

        raise_layer {
            // ------------------------------------------------------------------------------------------------------------
            // | BTCLR | BT1 | BT2 |  BT3 |  BT4 |  BT5 |                   |      |       |       |      |       |       |
            // |   `   |  !  |  @  |  #   |  $   |  %   |                   |  ^   |   &   |   *   |  (   |   )   |   ~   |
            // |   F1  |  F2 |  F3 |  F4  |  F5  |  F6  |                   |      |   <-  |   v   |  ^   |  ->   |       |
            // |   F7  |  F8 |  F9 |  F10 |  F11 |  F12 |        |  |       |  +   |   -   |   =   |  [   |   ]   |   \   |
            //                     |      |      |      |        |  |       |      |       |       |

            display-name = "Raise";
            bindings = <
&bt BT_CLR  &bt BT_SEL 0  &bt BT_SEL 1  &bt BT_SEL 2  &bt BT_SEL 3  &bt BT_SEL 4              &trans       &trans     &trans          &trans     &trans     &trans
&kp GRAVE   &kp EXCL      &kp AT        &kp HASH      &kp DOLLAR    &kp PRCNT                  &kp CARET    &kp AMPS   &kp KP_MULTIPLY  &kp LPAR   &kp RPAR   &kp TILDE
&kp F1     &kp F2  &kp F3  &kp F4   &kp F5   &kp F6                     &trans       &kp LEFT   &kp DOWN   &kp UP    &kp RIGHT  &trans
&kp F7     &kp F8  &kp F9  &kp F10  &kp F11  &kp F12  &trans    &trans  &kp KP_PLUS  &kp MINUS  &kp EQUAL  &kp LBKT  &kp RBKT   &kp BSLH
                           &trans   &trans   &trans   &trans    &trans  &trans       &trans     &trans
            >;
        };

        lights {
            // ------------------------------------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------------------------------------
            // |       | BASE|     |      |      |      |                   |      |       |       |      |       |       |
            // |       | RGB | RGB |      |      |      |                   |      |   7   |   8   |  9   |   0   |       |
            // |       | BR+ | BR- |      |      |      |                   |      |   <-  |   v   |  ^   |  ->   |       |
            // |       |     |     |      |      |      |        |  |       |      |   -   |   =   |  [   |   ]   |   \   |
            //                     |      |      |      |        |  |       |      |       |       |

            display-name = "Lights";
            bindings = <
&none  &tog 0           &none            &none  &none  &none                  &none  &none      &none      &none     &none      &none
&none  &rgb_ug RGB_ON   &rgb_ug RGB_OFF  &none  &none  &none                  &none  &kp N7     &kp N8     &kp N9    &kp N0     &none
&none  &rgb_ug RGB_BRI  &rgb_ug RGB_BRD  &none  &none  &none                  &none  &kp LEFT   &kp DOWN   &kp UP    &kp RIGHT  &none
&none  &none            &none            &none  &none  &none  &none    &none  &none  &kp MINUS  &kp EQUAL  &kp LBKT  &kp RBKT   &kp BSLH
                                         &none  &none  &none  &none    &none  &none  &none      &none
            >;
        };

    };
};
